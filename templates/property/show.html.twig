{% extends 'base.html.twig' %}

{% block title 'AgenceWeb - ' ~ property.title %}
{% block description '' ~ property.content %}
{% block url '' ~ path('property.show', {slug: property.slug, id: property.id}) %}
{% block url2 '' ~ path('property.show', {slug: property.slug, id: property.id}) %}
{% block title2 'AgenceWeb - ' ~ property.title %}
{% block title3 'AgenceWeb - ' ~ property.title %}
{% block description2 '' ~ property.content %}
{% block description3 '' ~ property.content %}

{% block stylesheets %}

<style>
	.jumbotron {
		margin: 0 auto !important;
	}
</style>

{% endblock %}

{% block body %}

	<div class="jumbotron pt-3 pb-3">
		<div class="container">

			{% for message in app.flashes('success') %}
				<div class="alert alert-success text-center w-25 m-auto mb-3">
					<i class="fa fa-check text-success" aria-hidden="true"></i> {{ message }}
				</div>
			{% endfor %}

			{% if not form.vars.valid %}
				<div class="alert alert-danger text-center w-25 m-auto mb-3">
					<i class="fas fa-times text-danger" aria-hidden="true"></i> Une erreur est survenue !
				</div>
			{% endif %}

			<div class="row" style="justify-content: center;">
				<div class="col-md-7">
					<div data-slider>
						{% if property.pictures is empty %}
							<img src="{{ '/images/empty.jpg' }}" alt="card-img-top" style="width: 100%; height:auto;">
						{% else %}
							{% for picture in property.pictures %}
								<div style="background: url('{{ vich_uploader_asset(picture, 'imageFile') }}'); background-position: center; width: 100%; height:210px;"></div>
							{% endfor %}
						{% endif %}
					</div>
				</div>
				<div class="col-md-4 ml-4 mr-4 col-4 col-sm-4">
					<h3>{{ property.title }}</h3>
					<h6>Mise en ligne par {{ property.createdBy }}</h6>
					<h5>{{ property.rooms }}
						pièces -
						{{ property.surface }}
						m²</h5>
					<h6>{% if property.sold == 0 %}<i class="fas fa-check text-success"></i> Disponible{% else %}<i class="fas fa-times text-danger"></i> Vendu{% endif %}</h6>
					<div class="text-success" style="font-size: 2rem;font-weight: bold;">{{ property.formattedPrice }}
						€</div>
					<a href="#" class="btn btn-primary" id="contactButton" {% if form.vars.submitted %} style="display: none;" {% endif %}>Contacter l'agence</a>
					<div id="contactForm" class="mt-4" {% if not form.vars.submitted %} style="display: none;" {% endif %}>
						{{ form_start(form, {'attr': {'id': 'captcha'}}) }}
						<div class="row">
							<div class="col">{{ form_row(form.firstname) }}</div>
							<div class="col">{{ form_row(form.lastname) }}</div>
						</div>
						<div class="row">
							<div class="col">{{ form_row(form.phone) }}</div>
							<div class="col">{{ form_row(form.email) }}</div>
						</div>
						{{ form_rest(form) }}
						<script src="https://www.google.com/recaptcha/api.js"></script>
						<script>
							function onSubmit2(token) {
                document.getElementById("captcha").submit();
              }
						</script>
						<button class="btn btn-primary g-recaptcha" data-sitekey="6Lcwj5MaAAAAACDE4Nd4kYXFmK7FprQAHzf5xjvW" data-callback='onSubmit2' data-action='submit'>Envoyer</button>
						{{ form_end(form) }}
            
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container mt-4 mb-4">
	<hr/>
		<p>
			{{ property.content | nl2br }}
		</p>

	<hr/>

		<div class="row">
			<div class="col-md-8">
				<h2>Caractéristiques</h2>
				<table class="table table-striped">
					<tr>
						<td>Surface habitable</td>
						<td>{{ property.surface }}
							m²</td>
					</tr>
					<tr>
						<td>Pièces</td>
						<td>{{ property.rooms }}</td>
					</tr>
					<tr>
						<td>Chambres</td>
						<td>{{ property.bedrooms }}</td>
					</tr>
					<tr>
						<td>Etage</td>
						<td>{{ property.floor }}</td>
					</tr>
					<tr>
						<td>Chauffage</td>
						<td>{{ property.heatType }}</td>
					</tr>
				</table>
			</div>
			<div class="col-md-4">
				<h2>Spécificités</h2>
				<ul class="list-group">
					{% for option in property.options %}
						<li class="list-group-item">{{ option.name }}</li>
					{% endfor %}
				</ul>
			</div>
			<hr/>
		</div>
		<div id="map" style="width: 100%; height: 400px" data-lat="{{ property.lat }}" data-lng="{{ property.lng }}"></div>
	</div>
{% endblock %}
